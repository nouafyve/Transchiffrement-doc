\documentclass[a4paper,11pt,french]{report}
\usepackage[utf8]{inputenc}

\usepackage[T1]{fontenc}
\usepackage[francais]{babel} 
\usepackage[top=2cm, bottom=2cm, left=2cm, right=2cm, includeheadfoot]{geometry} %pour les marges
\usepackage{lmodern}
\usepackage{pict2e}
\usepackage{fancyhdr} % Required for custom headers
\usepackage{lastpage} % Required to determine the last page for the footer
\usepackage{extramarks} % Required for headers and footers
\usepackage{graphicx} % Required to insert images
\usepackage{tabularx, longtable}
\usepackage{color, colortbl}
\usepackage{lscape}
%\usepackage[hidelinks]{hyperref}
\usepackage{longtable}
\usepackage{multirow}
\usepackage{rotating}
\usepackage{gensymb}
\usepackage{tikz}
\usepackage{pgfplots}


\linespread{1.1} % Line spacing

% Set up the header and footer
\pagestyle{fancy}
\lhead{\textbf{\hmwkClass -- \hmwkSubject \\ \hmwkTitle \\ \hmwkDocName}} % Top left header
\rhead{\includegraphics[width=10em]{../../images/logo_univ.png}}
\lfoot{\lastxmark} % Bottom left footer
\cfoot{} % Bottom center footer
\rfoot{Page\ \thepage\ / \pageref{LastPage}} % Bottom right footer
\renewcommand\headrulewidth{0.4pt} % Size of the header rule
\renewcommand\footrulewidth{0.4pt} % Size of the footer rule

\setlength{\headheight}{40pt}

\newcommand{\hmwkTitle}{Projet transchiffrement SSL/TLS} % Assignment title
\newcommand{\hmwkClass}{Master 2 SSI } % Course/class
\newcommand{\hmwkAuthorName}{Julien BOURDON, Émile GÉNÉRAT, Jean-Baptiste SOUCHAL} % Your name
\newcommand{\hmwkSubject}{} % Subject
\newcommand{\hmwkDocName}{Rapport final} % Document name

\newcommand{\version}{1.0} % Document version
\newcommand{\docDate}{20 février 2014} % Document date
\newcommand{\checked}{} % Checker name
\newcommand{\approved}{} % Approver name

\makeatletter
\newcommand{\resettranslate}{\let\translate\@firstofone}
\makeatother

\definecolor{gris}{rgb}{0.95, 0.95, 0.95}

\title{
\vspace{2in}
\textmd{\textbf{\hmwkClass :\ \hmwkTitle}}\\
\normalsize\vspace{0.1in}\small{Due\ on\ \hmwkDueDate}\\
\vspace{0.1in}\large{\textit{\hmwkClassInstructor\ \hmwkClassTime}}
\vspace{3in}
}

\author{\hmwkAuthorName}
\date{} % Insert date here if you want it to appear below your name


\usepackage{amsmath}
\begin{document}
\newcount\startdate
\newcount\daynum
%\pgfcalendardatetojulian{2013-01-021}{\startdate}
\pagestyle{fancy}

\vspace*{5cm}
\begin{center}\textbf{\Huge{\hmwkDocName}}\end{center}
\vspace*{4.5cm}
	

\fcolorbox{black}{gris}{
\begin{minipage}{15cm}
\begin{tabularx}{10cm}{lXl}
	\bfseries{Version} & & \version\\
	& & \\
	\bfseries{Date} & & \docDate\\
	& & \\
	\bfseries{Rédigé par} & & \hmwkAuthorName \\
	& & \\
	\bfseries{Relu par} & & \checked \\
	& & \\
	\bfseries{Approuvé par} & & \approved \\
	& & \\
\end{tabularx}
\end{minipage}
}

\newpage

%La table des matières
\clearpage
\tableofcontents
\clearpage

\chapter{Présentation du projet}


\section{Introduction}
\input{../../PDD/introduction.tex}



\section{Spécifications}

\subsection{Cas d'utilisation}
\includegraphics[width=0.8\textwidth]{../../STB/images/cas_utilisation.pdf}

\subsection{Schéma du système}
\includegraphics[width=0.8\textwidth]{../../STB/images/schema_autorites.pdf}


\section{Gestion de projet}

\subsection{L'équipe}

Pour mener à bien ce projet, nous sommes une équipe de 5 étudiants.

Nous nous sommes répartis autour des deux parties principales parties du projet.
\begin{itemize}
  \item Un proxy de transchiffrement SSL.
  \item La rechercher de collision sur des certificats de type MD5.

\end{itemize}

\subsection{Présentation des livrables}

Les fonctionnalités finales attendues sont :
\begin{itemize}
\item Une application servant de proxy réalisant du transchiffrement SSL.
\item Un dossier de recherche sur les collisions de certificats de type MD5, ainsi qu'une mise en oeuvre 
par un algorithme de recherche.
\end{itemize}

\subsection{Évolution du planning et des priorités}

Nous avons rencontré des difficultés dans la réalisation du projet.
En accord avec le client, nous avons privilégié la réalisation du programme applicatif de proxy.

\subsection{Gestion des risques}

Nous avons établi une liste des risques qui pouvaient menacer la réussite du projet.

Ces risques ont fait l'objet d'une attention particulière, tout au long du projet.

\chapter{Proxy SSL/TLS}
\section{Analyse}

\subsection{Cibles visées par l'attaque}

\subsection{Protocole TLS}
\input{text/tls.tex}

\section{Conception}

\subsection{UML}
\includegraphics[width=0.8\textwidth]{images/uml.pdf}
~~\\
~~\\
Rôle des différentes classes:
\begin{itemize}
	\item Transchiffrement: classe principale de l'application, elle contient le main et va permettre la création de la socket serveur et la détection du type de connexion entrantes (HTTP ou HTTPS).
	\item GenerationCertificat: cette classe permet de forger un faux certificat en fonction de celui récupéré lors de l'établissement d'une connexion HTTPS.
	\item Transfert: classe permettant la création de threads pour l'échange des données entre les différentes entités (voir schéma partie 2.4.1).
	\item Connexion: une classe abstraite qui permet de mutualiser le code commun entre les connexions HTTP ou HTTPS.
	\item ConnexionHTTP: permet de gérer les connexions HTTP, avec le lancement de deux threads pour l'échange des données grâce a la classe Transfert.
	\item ConnexionHTTPS: permet de gérer les connexions HTTPS, appel de la classe GenerationCertificat pour forger le faux certificat et lancement de deux threads pour l'échange des données grâce a la classe Transfert.
	\item Constantes: cette classe regroupe toutes les valeurs constantes utilisées dans la plupart des classes du projet.
	\item JournalFichier: cette classe permet la création, l'ouverture et le remplissage d'un fichier de avec les logs récupérés lors des échanges de type HTTP et HTTPS.
\end{itemize}

\section{Implémentation}
\subsection{Faire accepter une autorité}
\input{text/Autorites.tex}

\subsection{Threads}

Une fois une connexion établie, nous avons au niveau du proxy deux Sockets (bi-directionnelles), une vers le serveur, et une vers le client.

Chaque Socket est composée de deux Stream (uni-directionnels), un en entrée et l'autre en sortie.

Jusqu'à ce que la connexion soit interrompue, nous devons faire transiter les paquets, de l'entrée vers la sortie, et réciproquement pour le deuxième stream de la socket.

Pour ce faire, pour chaque nous lançons un objet de type Transfert dans un nouveau Thread.

Cela permet de continuer les traitements en parallèle, sans que l'application soit bloquée par un read.

\includegraphics[width=0.8\textwidth]{images/thread.pdf}

\subsection{Sockets}
Pour ce projet, nous devons faire communiquer les différents composants du projet ensemble. Ces composants sont :
\begin{itemize}
\item le navigateur du client ;
\item le proxy ;
\item le serveur Web.
\end{itemize}

Suite à la phase d'analyse, nous avons décidé d'utiliser les sockets, qui sont implémentées en Java.

\subsection{Keystore}
\input{text/java.tex}

\subsection{Journalisation des échanges}
Un des objectif du proxy de transchiffrement est de pouvoir enregistrer tous les 
échanges entre un client et un serveur lors de leur communication. Dans ce but nous
avons réalisé une classe qui nous permet de stocker dans un fichier tout le trafic qui traverse le proxy.

Ensuite, nous avons développé une seconde méthode, pour chercher un éventuel champ password
dans un formulaire POST, ou passé avec GET. Même si en théorie le mot de passe ne doit jamais
être passé dans l'adresse, il existe toujours des développeurs peu précautionneux.
\section{Abstract}
\input{text/Auth_client.tex}

\section{Tests}

\chapter{Recherche de collision sur des certificats hachés en MD5}

\chapter{Synthèse}

\chapter{Annexes}
\input{text/Annexe_Autorites.tex}
\section{Captures d'écran de l'installation de l'autorité}

\end{document}
